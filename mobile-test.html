<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Mobile - WYD Tracker</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 10px;
            min-height: 100vh;
            color: white;
            font-size: 14px;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        .status {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
            margin: 8px 0;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
        }
        .success { border-left: 4px solid #2ecc71; }
        .error { border-left: 4px solid #e74c3c; }
        .info { border-left: 4px solid #3498db; }
        button {
            background: linear-gradient(135deg, #4285f4, #34a853);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px 2px;
            width: 100%;
            touch-action: manipulation;
        }
        button:hover, button:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        @media (max-width: 480px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± Teste Mobile - Google Auth</h1>
        <p>Diagn√≥stico espec√≠fico para dispositivos m√≥veis</p>
        
        <div id="environment" class="status info">
            <h3>üìç Detec√ß√£o de Ambiente</h3>
            <div id="envDetails"></div>
        </div>
        
        <div id="mobileInfo" class="status">
            <h3>üì± Informa√ß√µes Mobile</h3>
            <div id="mobileDetails"></div>
        </div>
        
        <div id="authStatus" class="status">
            <h3>üîê Status Google Auth</h3>
            <div id="authDetails">Aguardando teste...</div>
        </div>
        
        <div class="grid">
            <button onclick="testMobileAuth()">üß™ Teste Auth</button>
            <button onclick="testMobileFeatures()">üì± Teste Mobile</button>
            <button onclick="showDebugInfo()">üêõ Debug</button>
            <button onclick="clearLogs()">üóëÔ∏è Limpar</button>
        </div>
        
        <div id="logs" class="status" style="max-height: 200px; overflow-y: auto;">
            <h3>üìù Logs Mobile</h3>
            <div id="logContent"></div>
        </div>
    </div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        const CLIENT_ID = '507473876859-o0urtsgjnetchqkqcf16ium53ejp1tts.apps.googleusercontent.com';
        let gauth = null;
        
        function log(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            logEntry.style.color = type === 'error' ? '#e74c3c' : type === 'success' ? '#2ecc71' : '#ecf0f1';
            logEntry.style.fontSize = '11px';
            logEntry.style.marginBottom = '3px';
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
        }
        
        function detectMobile() {
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            const isTablet = /iPad|Android(?=.*Mobile)/i.test(userAgent);
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            const screenWidth = window.screen.width;
            const screenHeight = window.screen.height;
            
            return {
                isMobile,
                isTablet,
                isTouchDevice,
                screenWidth,
                screenHeight,
                userAgent: userAgent.substring(0, 100) + '...',
                orientation: screen.orientation ? screen.orientation.type : 'N/A'
            };
        }
        
        function updateEnvironment() {
            const envDetails = document.getElementById('envDetails');
            const mobileDetails = document.getElementById('mobileDetails');
            
            // Informa√ß√µes de ambiente
            const protocol = window.location.protocol;
            const hostname = window.location.hostname;
            const url = window.location.href;
            
            const isHTTPS = protocol === 'https:';
            const isLocalhost = hostname === 'localhost' || hostname === '127.0.0.1';
            const isGitHubPages = hostname === 'luizcborba.github.io';
            const shouldUseAuth = isHTTPS || isLocalhost;
            
            envDetails.innerHTML = `
                <strong>URL:</strong> ${url.substring(0, 60)}...<br>
                <strong>Protocol:</strong> ${protocol} ${isHTTPS ? '‚úÖ' : '‚ùå'}<br>
                <strong>Hostname:</strong> ${hostname}<br>
                <strong>GitHub Pages:</strong> ${isGitHubPages ? '‚úÖ' : '‚ùå'}<br>
                <strong>Deve usar Auth:</strong> ${shouldUseAuth ? '‚úÖ SIM' : '‚ùå N√ÉO'}
            `;
            
            // Informa√ß√µes mobile
            const mobile = detectMobile();
            mobileDetails.innerHTML = `
                <strong>Mobile:</strong> ${mobile.isMobile ? '‚úÖ SIM' : '‚ùå N√ÉO'}<br>
                <strong>Tablet:</strong> ${mobile.isTablet ? '‚úÖ SIM' : '‚ùå N√ÉO'}<br>
                <strong>Touch:</strong> ${mobile.isTouchDevice ? '‚úÖ SIM' : '‚ùå N√ÉO'}<br>
                <strong>Tela:</strong> ${mobile.screenWidth}x${mobile.screenHeight}<br>
                <strong>Orienta√ß√£o:</strong> ${mobile.orientation}<br>
                <strong>User Agent:</strong> ${mobile.userAgent}
            `;
            
            mobileDetails.parentElement.className = `status ${mobile.isMobile ? 'success' : 'info'}`;
            
            log(`Ambiente detectado: ${protocol}//${hostname}`);
            log(`Mobile: ${mobile.isMobile}, Touch: ${mobile.isTouchDevice}`);
            log(`Auth deve funcionar: ${shouldUseAuth}`);
        }
        
        async function testMobileAuth() {
            const authDetails = document.getElementById('authDetails');
            
            try {
                log('üß™ Iniciando teste de autentica√ß√£o mobile...');
                
                // Verificar ambiente
                const isHTTPS = window.location.protocol === 'https:';
                const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                
                if (!isHTTPS && !isLocalhost) {
                    log('‚ùå Ambiente HTTP detectado - Google Auth n√£o funciona', 'error');
                    authDetails.innerHTML = '‚ùå HTTP detectado - Google Auth requer HTTPS';
                    authDetails.parentElement.className = 'status error';
                    return;
                }
                
                log('‚úÖ Ambiente HTTPS/localhost - prosseguindo...');
                
                // Carregar e inicializar
                await new Promise((resolve, reject) => {
                    gapi.load('auth2', async () => {
                        try {
                            log('Inicializando Google Auth para mobile...');
                            
                            gauth = await gapi.auth2.init({
                                client_id: CLIENT_ID,
                                scope: 'profile email',
                                fetch_basic_profile: true,
                                ux_mode: 'popup' // Importante para mobile
                            });
                            
                            log('‚úÖ Google Auth inicializado!', 'success');
                            authDetails.innerHTML = '‚úÖ Google Auth pronto para mobile';
                            authDetails.parentElement.className = 'status success';
                            
                            // Tentar login
                            log('Tentando login mobile...');
                            const user = await gauth.signIn();
                            const profile = user.getBasicProfile();
                            
                            log(`‚úÖ Login mobile realizado: ${profile.getName()}`, 'success');
                            authDetails.innerHTML = `‚úÖ Login mobile OK!<br>üë§ ${profile.getName()}`;
                            
                            resolve();
                        } catch (error) {
                            log(`‚ùå Erro mobile: ${error.error || error}`, 'error');
                            authDetails.innerHTML = `‚ùå Erro mobile: ${error.error || 'Desconhecido'}`;
                            authDetails.parentElement.className = 'status error';
                            reject(error);
                        }
                    });
                });
                
            } catch (error) {
                log(`‚ùå Erro geral: ${error.message || error}`, 'error');
            }
        }
        
        function testMobileFeatures() {
            log('üîç Testando recursos mobile...');
            
            // Teste de touch
            log(`Touch events: ${('ontouchstart' in window) ? 'Suportados ‚úÖ' : 'N√£o suportados ‚ùå'}`);
            
            // Teste de orienta√ß√£o
            if (screen.orientation) {
                log(`Orienta√ß√£o: ${screen.orientation.type} ‚úÖ`);
            } else {
                log('API de orienta√ß√£o: N√£o suportada ‚ùå');
            }
            
            // Teste de vibra√ß√£o
            if (navigator.vibrate) {
                log('Vibra√ß√£o: Suportada ‚úÖ');
                navigator.vibrate(100); // Vibrar brevemente
            } else {
                log('Vibra√ß√£o: N√£o suportada ‚ùå');
            }
            
            // Teste de service worker
            if ('serviceWorker' in navigator) {
                log('Service Worker: Suportado ‚úÖ');
            } else {
                log('Service Worker: N√£o suportado ‚ùå');
            }
            
            // Teste de notifica√ß√µes
            if ('Notification' in window) {
                log(`Notifica√ß√µes: ${Notification.permission} ‚úÖ`);
            } else {
                log('Notifica√ß√µes: N√£o suportadas ‚ùå');
            }
            
            // Teste de localStorage
            try {
                localStorage.setItem('test', 'ok');
                localStorage.removeItem('test');
                log('localStorage: Funcionando ‚úÖ');
            } catch (e) {
                log('localStorage: Erro ‚ùå', 'error');
            }
        }
        
        function showDebugInfo() {
            log('=== DEBUG MOBILE ===');
            const mobile = detectMobile();
            
            log(`User Agent completo: ${navigator.userAgent}`);
            log(`Idioma: ${navigator.language}`);
            log(`Platform: ${navigator.platform}`);
            log(`Cookie habilitado: ${navigator.cookieEnabled}`);
            log(`Online: ${navigator.onLine}`);
            log(`Tela: ${screen.width}x${screen.height} @ ${screen.pixelDepth}bit`);
            log(`Viewport: ${window.innerWidth}x${window.innerHeight}`);
            log(`Zoom: ${window.devicePixelRatio || 1}`);
            
            if (mobile.isMobile) {
                log('‚úÖ Dispositivo mobile confirmado');
            } else {
                log('‚ÑπÔ∏è N√£o parece ser mobile');
            }
        }
        
        function clearLogs() {
            document.getElementById('logContent').innerHTML = '';
            log('Logs limpos');
        }
        
        // Inicializar
        updateEnvironment();
        
        // Auto-detectar mudan√ßas de orienta√ß√£o
        if (screen.orientation) {
            screen.orientation.addEventListener('change', () => {
                log(`Orienta√ß√£o mudou para: ${screen.orientation.type}`);
                updateEnvironment();
            });
        }
    </script>
</body>
</html>