<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª Teste Supabase + Google Auth</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        
        .test-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            margin: 10px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
        }
        
        .success { color: #2ecc71; }
        .error { color: #e74c3c; }
        .warning { color: #f39c12; }
        
        .logs {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Teste Supabase + Google Auth</h1>
        
        <div class="status-card">
            <h3>ğŸ“Š Status do Sistema</h3>
            <div id="systemStatus">Carregando...</div>
        </div>
        
        <div class="status-card">
            <h3>ğŸ‘¤ Status do UsuÃ¡rio</h3>
            <div id="userStatus">NÃ£o logado</div>
        </div>
        
        <div class="status-card">
            <h3>ğŸ§ª Testes DisponÃ­veis</h3>
            <button class="test-btn" onclick="testSupabaseConnection()">
                ğŸ”— Testar ConexÃ£o Supabase
            </button>
            <button class="test-btn" onclick="testGoogleLogin()">
                ğŸ” Testar Login Google
            </button>
            <button class="test-btn" onclick="testDataUpload()">
                â¬†ï¸ Testar Upload de Dados
            </button>
            <button class="test-btn" onclick="testDataDownload()">
                â¬‡ï¸ Testar Download de Dados
            </button>
            <button class="test-btn" onclick="testLogout()">
                ğŸšª Testar Logout
            </button>
        </div>
        
        <div class="status-card">
            <h3>ğŸ“ Logs</h3>
            <button class="test-btn" onclick="clearLogs()" style="float: right; padding: 5px 10px;">
                ğŸ—‘ï¸ Limpar
            </button>
            <div id="logs" class="logs">
                [Carregando sistema...]<br>
            </div>
        </div>
        
        <div class="status-card">
            <h3>âš™ï¸ ConfiguraÃ§Ã£o NecessÃ¡ria</h3>
            <p>Para funcionar corretamente, vocÃª precisa:</p>
            <ul>
                <li>âœ… Criar projeto no Supabase</li>
                <li>âœ… Configurar Google OAuth</li>
                <li>âœ… Atualizar URLs em supabase-sync.js</li>
                <li>âœ… Configurar tabela game_data</li>
            </ul>
            <p><strong>Veja o arquivo SETUP_SUPABASE.md para instruÃ§Ãµes completas!</strong></p>
        </div>
    </div>

    <script src="supabase-sync.js"></script>
    <script>
        // Mock data para testes
        const data = {
            quests: { checkin: true, spoils: false },
            totalXP: 1250,
            level: 2,
            streak: 5,
            lastSync: new Date().toISOString()
        };

        function showAchievement(message) {
            log(message);
        }

        function saveData() {
            localStorage.setItem('wydQuestData', JSON.stringify(data));
            log('ğŸ’¾ Dados salvos localmente');
        }

        function updateUI() {
            log('ğŸ”„ UI atualizada');
        }

        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#e74c3c' : type === 'success' ? '#2ecc71' : type === 'warning' ? '#f39c12' : '#3498db';
            
            logs.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span><br>`;
            logs.scrollTop = logs.scrollHeight;
            
            console.log(message);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        function updateStatus() {
            const systemStatus = document.getElementById('systemStatus');
            const userStatus = document.getElementById('userStatus');
            
            if (window.supabaseSync) {
                const status = supabaseSync.getStatus();
                
                systemStatus.innerHTML = `
                    <div class="${status.isInitialized ? 'success' : 'error'}">
                        Supabase: ${status.isInitialized ? 'âœ… Conectado' : 'âŒ Desconectado'}
                    </div>
                    <div class="${status.hasSupabase ? 'success' : 'error'}">
                        Cliente: ${status.hasSupabase ? 'âœ… Carregado' : 'âŒ NÃ£o carregado'}
                    </div>
                `;
                
                if (status.user) {
                    userStatus.innerHTML = `
                        <div class="success">âœ… Logado como: ${status.user.user_metadata.name || status.user.email}</div>
                        <div>ID: ${status.user.id}</div>
                        <div>Email: ${status.user.email}</div>
                    `;
                } else {
                    userStatus.innerHTML = '<div class="warning">âš ï¸ NÃ£o logado</div>';
                }
            } else {
                systemStatus.innerHTML = '<div class="error">âŒ supabaseSync nÃ£o carregado</div>';
                userStatus.innerHTML = '<div class="error">âŒ Sistema nÃ£o disponÃ­vel</div>';
            }
        }

        // Testes
        async function testSupabaseConnection() {
            log('ğŸ”— Testando conexÃ£o com Supabase...', 'info');
            
            if (!window.supabaseSync) {
                log('âŒ supabaseSync nÃ£o estÃ¡ disponÃ­vel', 'error');
                return;
            }
            
            try {
                const result = await supabaseSync.init();
                if (result) {
                    log('âœ… ConexÃ£o com Supabase estabelecida!', 'success');
                } else {
                    log('âŒ Falha ao conectar com Supabase', 'error');
                }
            } catch (error) {
                log(`âŒ Erro na conexÃ£o: ${error.message}`, 'error');
            }
            
            updateStatus();
        }

        async function testGoogleLogin() {
            log('ğŸ” Iniciando teste de login Google...', 'info');
            
            if (!window.supabaseSync) {
                log('âŒ supabaseSync nÃ£o disponÃ­vel', 'error');
                return;
            }
            
            try {
                await supabaseSync.signInWithGoogle();
                log('ğŸ”„ Redirecionando para Google OAuth...', 'info');
            } catch (error) {
                log(`âŒ Erro no login: ${error.message}`, 'error');
            }
        }

        async function testDataUpload() {
            log('â¬†ï¸ Testando upload de dados...', 'info');
            
            if (!window.supabaseSync) {
                log('âŒ supabaseSync nÃ£o disponÃ­vel', 'error');
                return;
            }
            
            const status = supabaseSync.getStatus();
            if (!status.isLoggedIn) {
                log('âš ï¸ Precisa estar logado para fazer upload', 'warning');
                return;
            }
            
            try {
                await supabaseSync.uploadData();
                log('âœ… Upload de dados concluÃ­do!', 'success');
            } catch (error) {
                log(`âŒ Erro no upload: ${error.message}`, 'error');
            }
        }

        async function testDataDownload() {
            log('â¬‡ï¸ Testando download de dados...', 'info');
            
            if (!window.supabaseSync) {
                log('âŒ supabaseSync nÃ£o disponÃ­vel', 'error');
                return;
            }
            
            const status = supabaseSync.getStatus();
            if (!status.isLoggedIn) {
                log('âš ï¸ Precisa estar logado para fazer download', 'warning');
                return;
            }
            
            try {
                await supabaseSync.downloadData();
                log('âœ… Download de dados concluÃ­do!', 'success');
            } catch (error) {
                log(`âŒ Erro no download: ${error.message}`, 'error');
            }
        }

        async function testLogout() {
            log('ğŸšª Testando logout...', 'info');
            
            if (!window.supabaseSync) {
                log('âŒ supabaseSync nÃ£o disponÃ­vel', 'error');
                return;
            }
            
            try {
                await supabaseSync.signOut();
                log('âœ… Logout realizado!', 'success');
                updateStatus();
            } catch (error) {
                log(`âŒ Erro no logout: ${error.message}`, 'error');
            }
        }

        // InicializaÃ§Ã£o
        window.addEventListener('load', async () => {
            log('ğŸš€ PÃ¡gina carregada, inicializando testes...', 'info');
            
            // Aguardar um pouco para garantir que tudo carregou
            setTimeout(async () => {
                if (window.supabaseSync) {
                    log('ğŸ“¦ supabaseSync detectado, inicializando...', 'info');
                    try {
                        await supabaseSync.init();
                        log('âœ… Sistema inicializado com sucesso!', 'success');
                    } catch (error) {
                        log(`âŒ Erro na inicializaÃ§Ã£o: ${error.message}`, 'error');
                    }
                } else {
                    log('âŒ supabaseSync nÃ£o foi carregado', 'error');
                }
                
                updateStatus();
            }, 1000);
        });

        // Atualizar status periodicamente
        setInterval(updateStatus, 5000);
    </script>
</body>
</html>